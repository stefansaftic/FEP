/*! FEP 2014-04-06 */
(function(){var a,b,c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e="undefined"!=typeof exports&&null!==exports?exports:window,d=function(){function a(a){this.debug=a}return a.prototype.log=function(a){if(0!==this.debug){if("undefined"!=typeof console&&null!==console)return console.log(a);if("undefined"!=typeof alert&&null!==alert)return alert(a)}},a}(),null==e.FEP&&(e.FEP={}),e.FEP.FLog=d,e="undefined"!=typeof exports&&null!==exports?exports:window,c=function(){function a(a,b,c){this.name=a,this.version=b,this.debug=null!=c?c:0,this.status="created",this.initData(),this.logger=new d(this.debug)}return a.prototype.start=function(){return this.status="started"},a.prototype.end=function(){return this.status="ended"},a.prototype.pause=function(){return"started"===this.status?this.status="paused":"paused"===this.status?this.status="started":this.logger.log("Paused while game status is: "+this.status)},a.prototype.initData=function(){return this.data={}},a}(),null==e.FEP&&(e.FEP={}),e.FEP.FGame=c,e="undefined"!=typeof exports&&null!==exports?exports:window,b=function(){function a(a,b){switch(this.type=a,this.debug=b,this.logger=new d(this.debug),this.mapKeys={},this.type){case"keyboard":document.addEventListener("keydown",this.trigger.bind(this));break;case"custom":this.logger.log("Custom controller");break;default:this.logger.log("Controller type:"+this.type+" not implemented")}}return a.prototype.mapKey=function(a,b){return this.mapKeys[a]=b},a.prototype.unmapKey=function(a){return null!=this.mapKeys[a]?delete this.mapKeys[a]:void 0},a.prototype.trigger=function(a){switch(this.type){case"keyboard":return null!=this.mapKeys[a.keyCode]?this.mapKeys[a.keyCode]():this.logger.log(a.keyCode);case"custom":return null!=this.mapKeys[a.keyCode]?this.mapKeys[a.keyCode]():this.logger.log(a.keyCode);default:return this.logger.log("Controller type:"+this.type+" not implemented")}},a}(),null==e.FEP&&(e.FEP={}),e.FEP.FController=b,e="undefined"!=typeof exports&&null!==exports?exports:window,a=function(a){function b(a){this.debug=null!=a?a:0,b.__super__.constructor.call(this,"ATOB","1.0",this.debug)}return g(b,a),b.prototype.initData=function(){return this.data={score:0,ground:[[0,0,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,-2]],player:{x:0,y:0},lock:!1,n:4}},b.prototype.start=function(){return b.__super__.start.call(this),radio("render").broadcast(this.data.ground),radio("renderPlayer").broadcast(this.data.player),this.logger.log("Game ATOB started"),radio("moveUp").subscribe([this.moveUp,this]),radio("moveDown").subscribe([this.moveDown,this]),radio("moveLeft").subscribe([this.moveLeft,this]),radio("moveRight").subscribe([this.moveRight,this])},b.prototype.validateMove=function(a){return this.data.ground[a.x][a.y]<=0?!0:!1},b.prototype.checkFinish=function(a){return-2===this.data.ground[a.x][a.y]?this.end():void 0},b.prototype.moveDown=function(){var a;return this.data.lock===!1&&this.data.n>this.data.player.x+1?(this.data.lock=!0,a={x:this.data.player.x,y:this.data.player.y},a.x++,this.validateMove(a)?(this.checkFinish(a),this.data.player=a,radio("renderMoveDown").broadcast(!0)):radio("renderMoveDown").broadcast(!1),this.data.lock=!1):void 0},b.prototype.moveUp=function(){var a;return this.data.lock===!1&&0<=this.data.player.x-1?(this.data.lock=!0,a={x:this.data.player.x,y:this.data.player.y},a.x--,this.validateMove(a)?(this.checkFinish(a),this.data.player=a,radio("renderMoveUp").broadcast(!0)):radio("renderMoveUp").broadcast(!1),this.data.lock=!1):void 0},b.prototype.moveLeft=function(){var a;return this.data.lock===!1&&0<=this.data.player.y-1?(this.data.lock=!0,a={x:this.data.player.x,y:this.data.player.y},a.y--,this.validateMove(a)?(this.checkFinish(a),this.data.player=a,radio("renderMoveLeft").broadcast(!0)):radio("renderMoveLeft").broadcast(!1),this.data.lock=!1):void 0},b.prototype.moveRight=function(){var a;return this.data.lock===!1&&this.data.n>this.data.player.y+1?(this.data.lock=!0,a={x:this.data.player.x,y:this.data.player.y},a.y++,this.validateMove(a)?(this.checkFinish(a),this.data.player=a,radio("renderMoveRight").broadcast(!0)):radio("renderMoveRight").broadcast(!1),this.data.lock=!1):void 0},b}(c),null==e.FEP&&(e.FEP={}),e.FEP.ATOB=a}).call(this);