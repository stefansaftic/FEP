/*! FEP 2014-05-13 */
(function(){var ATOB,FController,FEGroup,FEImage,FEJS,FGame,FInit,FLog,FPreload,FVisual,SNAKE,root,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};root="undefined"!=typeof exports&&null!==exports?exports:window,FVisual=function(){function a(a,b){this.name=a,this.data=b,this.created=!1,this.onStage=!1,this.events=[],this.graphic=null,this.id=this.name+this._guid(),this.create()}return a.prototype.clone=function(){var a;return a=new this(this.name,this.data)},a.prototype.log=function(a){return this.data.debug?root.FEP.Log.log(a):void 0},a.prototype._guid=function(){return"blah"},a.prototype.create=function(){throw new Error("Please override create method wich will store DisplayObject to @graphic")},a.prototype.showOnStage=function(){throw new Error("Please override showOnStage method wich will add @graphic to stage")},a.prototype.showOnStageBefore=function(){throw new Error("Please override showOnStageBefore method wich will add @graphic before object to stage")},a.prototype.showOnStageAfter=function(){throw new Error("Please override showOnStageAfter method wich will add @graphic after object to stage")},a.prototype.hideFromStage=function(){throw new Error("Please override hideFromStage method wich will remove @data.object to stage")},a}(),null==root.FEP&&(root.FEP={}),root.FEP.FVisual=FVisual,root="undefined"!=typeof exports&&null!==exports?exports:window,FEJS=function(a){function b(a,c){this.name=a,this.data=c,b.__super__.constructor.call(this,this.name,this.data)}return __extends(b,a),b.prototype.showOnStage=function(a,b){return null==this.graphic?(this.log("Graphic object not created"),!1):this.onStage?(this.log("Object is already on stage"),!1):(null==b&&(b=a.getNumChildren()),this.index=b,this.onStage=!0,a.addChildAt(this.graphic,this.index),!0)},b.prototype.showOnStageBefore=function(a,b){var c;return c=a.index,this.showOnStage(b,c)},b.prototype.showOnStageAfter=function(a,b){var c;return c=a.index+1,this.showOnStage(b,c)},b.prototype.hideFromStage=function(a){return this.onStage?(a.removeChildAt(this.index),this.onStage=!1,!0):(this.log("Object is not on stage"),!1)},b.prototype.cache=function(a,b,c,d,e){return null==e&&(e=1),this.cached=!0,this.data.cache={x:a,y:b,width:c,height:d,scale:e},this.graphic.cache(a,b,c,d,e)},b.prototype.cloneGraphic=function(){return this.graphic.clone()},b.prototype.getCacheDataURL=function(){return this.graphic.getCacheDataURL()},b.prototype.getStage=function(){return this.graphic.getStage()},b.prototype.getTransformedBound=function(){return this.graphic.getTransformedBound()},b.prototype.globalToLocal=function(a,b){return this.graphic.globalToLocal(a,b)},b.prototype.hasEventListener=function(a){return this.graphic.hasEventListener(a)},b.prototype.hitTest=function(a,b){return this.graphic.hitTest(a,b)},b.prototype.localToGlobal=function(a,b){return this.graphic.localToGlobal(a,b)},b.prototype.off=function(a,b,c){return null!=c?this.graphic.off(a,b,c):this.graphic.off(a,b)},b.prototype.on=function(a,b,c,d,e,f){return null==f&&(f=!1),this.graphic.on(a,b,c,d,e,f)},b.prototype.removeAllEventListeners=function(a){return null!=a?this.graphic.removeAllEventListeners(a):this.graphic.removeAllEventListeners()},b.prototype.setGraphicProps=function(a){return this.graphic.set(a)},b.prototype.setBounds=function(a,b,c,d){return this.graphic.setBounds(a,b,c,d)},b.prototype.setTransform=function(a,b,c,d,e,f,g,h,i){return null==a&&(a=0),null==b&&(b=0),null==c&&(c=1),null==d&&(d=1),null==e&&(e=0),null==f&&(f=0),null==g&&(g=0),null==h&&(h=0),null==i&&(i=0),this.graphic.setTransform(a,b,c,d,e,f,g,h,i)},b.prototype.uncache=function(){return this.cached=!1,delete this.data.cache,this.graphic.uncache()},b.prototype.updateCache=function(a){return this.cached?this.graphic.updateCache(a):this.log("No cache available")},b.prototype.setGraphic=function(a,b){return this.graphic[a]=b,this},b.prototype.getGraphic=function(a){return this.graphic[a]},b}(FVisual),null==root.FEP&&(root.FEP={}),root.FEP.FEJS=FEJS,root="undefined"!=typeof exports&&null!==exports?exports:window,FEImage=function(a){function b(a,c){this.name=a,this.data=c,b.__super__.constructor.call(this,this.name,this.data)}return __extends(b,a),b.prototype.create=function(){return this.graphic=new root.createjs.Bitmap(this.data.imageUrl),this.created=!0},b}(FEJS),null==root.FEP&&(root.FEP={}),root.FEP.FEImage=FEImage,root="undefined"!=typeof exports&&null!==exports?exports:window,FEGroup=function(a){function b(a,c){this.name=a,this.data=c,b.__super__.constructor.call(this,this.name,this.data)}return __extends(b,a),b.prototype.create=function(){return this.graphic=new root.createjs.Container,this.children={}},b.prototype.addChild=function(a){return null!=this.children[a.name]&&this.log('Child with name "'+name+'"" already exist, add impossible'),this.children[a.name]=a,this.graphic.addChild(a.graphic)},b.prototype.removeChild=function(a){return null!=this.children[a]?(this.graphics.removeChild(this.children[a]),delete this.children[a],!0):(this.log('Child with name "'+a+'"" does not exist, remove impossible'),!1)},b.prototype.getChild=function(a){return null!=this.children[a]?this.children[a]:(this.log('Child with name "'+a+'"" does not exist'),!1)},b}(FEJS),null==root.FEP&&(root.FEP={}),root.FEP.FEGroup=FEGroup,root="undefined"!=typeof exports&&null!==exports?exports:window,FGame=function(){function a(a,b,c){this.name=a,this.version=b,this.debug=null!=c?c:0,this.status="created",this.initData()}return a.prototype.log=function(a){return this.debug?root.FEP.Log.log(a):void 0},a.prototype.start=function(){return this.status="started"},a.prototype.end=function(){return this.status="ended"},a.prototype.pause=function(){return"started"===this.status?this.status="paused":"paused"===this.status?this.status="started":this.log("Paused while game status is: "+this.status)},a.prototype.initData=function(){return this.data={}},a}(),null==root.FEP&&(root.FEP={}),root.FEP.FGame=FGame,root="undefined"!=typeof exports&&null!==exports?exports:window,ATOB=function(a){function b(a){this.debug=null!=a?a:0,b.__super__.constructor.call(this,"ATOB","1.0",this.debug)}return __extends(b,a),b.prototype.initData=function(){return this.data={score:0,ground:[[0,0,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,-2]],player:{x:0,y:0},lock:!1,n:4}},b.prototype.start=function(){return b.__super__.start.call(this),radio("render").broadcast(this.data.ground),radio("renderPlayer").broadcast(this.data.player),this.log("Game ATOB started"),radio("moveUp").subscribe([this.moveUp,this]),radio("moveDown").subscribe([this.moveDown,this]),radio("moveLeft").subscribe([this.moveLeft,this]),radio("moveRight").subscribe([this.moveRight,this])},b.prototype.validateMove=function(a){return this.data.ground[a.x][a.y]<=0?!0:!1},b.prototype.checkFinish=function(a){return-2===this.data.ground[a.x][a.y]?this.end():void 0},b.prototype.moveDown=function(){var a;return this.data.lock===!1&&this.data.n>this.data.player.x+1?(this.data.lock=!0,a={x:this.data.player.x,y:this.data.player.y},a.x++,this.validateMove(a)?(this.checkFinish(a),this.data.player=a,radio("renderMoveDown").broadcast(!0)):radio("renderMoveDown").broadcast(!1),this.data.lock=!1):void 0},b.prototype.moveUp=function(){var a;return this.data.lock===!1&&0<=this.data.player.x-1?(this.data.lock=!0,a={x:this.data.player.x,y:this.data.player.y},a.x--,this.validateMove(a)?(this.checkFinish(a),this.data.player=a,radio("renderMoveUp").broadcast(!0)):radio("renderMoveUp").broadcast(!1),this.data.lock=!1):void 0},b.prototype.moveLeft=function(){var a;return this.data.lock===!1&&0<=this.data.player.y-1?(this.data.lock=!0,a={x:this.data.player.x,y:this.data.player.y},a.y--,this.validateMove(a)?(this.checkFinish(a),this.data.player=a,radio("renderMoveLeft").broadcast(!0)):radio("renderMoveLeft").broadcast(!1),this.data.lock=!1):void 0},b.prototype.moveRight=function(){var a;return this.data.lock===!1&&this.data.n>this.data.player.y+1?(this.data.lock=!0,a={x:this.data.player.x,y:this.data.player.y},a.y++,this.validateMove(a)?(this.checkFinish(a),this.data.player=a,radio("renderMoveRight").broadcast(!0)):radio("renderMoveRight").broadcast(!1),this.data.lock=!1):void 0},b}(FGame),null==root.FEP&&(root.FEP={}),root.FEP.ATOB=ATOB,root="undefined"!=typeof exports&&null!==exports?exports:window,SNAKE=function(a){function b(a){this.debug=null!=a?a:0,b.__super__.constructor.call(this,this.debug)}return __extends(b,a),b.prototype.validP=function(a){return a>=0&&a<this.data.n},b.prototype.validateMove=function(a){return this.data.ground[a.x][a.y]>=0?!0:!1},b.prototype.loop=function(){var a;return"started"===this.status?(a={x:this.data.player.x+this.data.direction.x,y:this.data.player.y+this.data.direction.y},this.validP(a.x)&&this.validP(a.y)&&this.validateMove(a)?this.move(a):(this.data.direction={x:0,y:0},this.end())):void 0},b.prototype.end=function(){return console.log("GameOver"),this.status="ended",radio("gameOver").broadcast()},b.prototype.move=function(a){return this.data.tmpdir=this.data.direction,this.log(a),this.data.ground[a.x][a.y]>0&&(this.data.tailAdd+=2*this.data.ground[a.x][a.y],window.engine.data.skip-=1,this.data.score+=100,radio("renderScore").broadcast(this.data.score),this.generateApple()),this.data.ground[this.data.player.x][this.data.player.y]=-2,this.data.ground[a.x][a.y]=-1,this.data.tail.push(a),this.data.player=a,0===this.data.tailAdd?(this.data.ground[this.data.tail[0].x][this.data.tail[0].y]=0,this.data.tail.shift()):this.data.tailAdd--,radio("renderAll").broadcast(this.data.ground)},b.prototype.generateApple=function(){for(var a,b;;)if(a=Math.round(10*Math.random())%this.data.n,b=Math.round(10*Math.random())%this.data.n,0===this.data.ground[a][b])break;return this.data.ground[a][b]=1},b.prototype.moveDown=function(){return-1!==this.data.tmpdir.y?this.data.direction={x:0,y:1}:void 0},b.prototype.moveUp=function(){return 1!==this.data.tmpdir.y?this.data.direction={x:0,y:-1}:void 0},b.prototype.moveLeft=function(){return 1!==this.data.tmpdir.x?this.data.direction={x:-1,y:0}:void 0},b.prototype.moveRight=function(){return-1!==this.data.tmpdir.x?this.data.direction={x:1,y:0}:void 0},b.prototype.initData=function(){return this.data={score:0,ground:[[-2,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],player:{x:0,y:0},tail:[{x:0,y:0}],direction:{x:1,y:0},tmpdir:{x:1,y:0},tailAdd:2,n:10}},b}(ATOB),null==root.FEP&&(root.FEP={}),root.FEP.SNAKE=SNAKE,root="undefined"!=typeof exports&&null!==exports?exports:window,FPreload=function(){function a(a,b,c){var d;d=new root.createjs.LoadQueue,d.on("fileload",b,this),d.on("complete",c,this),d.loadManifest(a)}return a}(),null==root.FEP&&(root.FEP={}),root.FEP.FPreload=FPreload,root="undefined"!=typeof exports&&null!==exports?exports:window,FLog=function(){function a(a){this.debug=a}return a.prototype.log=function(a){if(0!==this.debug){if("undefined"!=typeof console&&null!==console)return console.log(a);if("undefined"!=typeof alert&&null!==alert)return alert(a)}},a}(),null==root.FEP&&(root.FEP={}),root.FEP.FLog=FLog,root="undefined"!=typeof exports&&null!==exports?exports:window,FInit=function(){function a(a,b,c){this.game=a,this.controller=b,this.data=c,this.frame=0,this.initGraphics=function(){return this},root.FEP.Log=new FEP.FLog(this.data.debug)}return a.prototype.log=function(a){return this.data.debug?root.FEP.Log.log(a):void 0},a.prototype.onReady=function(){return this.initGraphics(),this.game.start(),this.loop()},a.prototype.loop=function(){return requestAnimationFrame(this.loop.bind(this)),0!==this.data.skip&&this.data.skip!==this.frame?this.frame++:(this.frame=0,this.game.loop())},a}(),null==root.FEP&&(root.FEP={}),root.FEP.FInit=FInit,root="undefined"!=typeof exports&&null!==exports?exports:window,FController=function(){function FController(a,b){switch(this.type=a,this.debug=b,this.mapKeys={},this.type){case"keyboard":document.addEventListener("keydown",this.trigger.bind(this));break;case"custom":this.log("Custom controller");break;default:this.log("Controller type:"+this.type+" not implemented")}}return FController.prototype.log=function(a){return this.debug?root.FEP.Log.log(a):void 0},FController.prototype.mapKey=function(a,b){return this.mapKeys[a]=b},FController.prototype.unmapKey=function(a){return null!=this.mapKeys[a]?delete this.mapKeys[a]:void 0},FController.prototype.trigger=function(event){switch(this.type){case"keyboard":return null!=this.mapKeys[event.keyCode]?"function"==typeof this.mapKeys[event.keyCode]?this.mapKeys[event.keyCode]():eval(this.mapKeys[event.keyCode]):this.log(event.keyCode);case"custom":return null!=this.mapKeys[event.keyCode]?"function"==typeof this.mapKeys[event.keyCode]?this.mapKeys[event.keyCode]():eval(this.mapKeys[event.keyCode]):this.log(event.keyCode);default:return this.log("Controller type:"+this.type+" not implemented")}},FController}(),null==root.FEP&&(root.FEP={}),root.FEP.FController=FController}).call(this);